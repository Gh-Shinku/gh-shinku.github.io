{{ define "main" }}

<div class="post-layout">
    <article class="post-content">
        <h1>{{ .Title }}</h1>
        {{ .Content }}
    </article>

    {{ if and .IsPage (or .Params.toc $.Site.Params.toc) }}
    <aside class="post-toc {{ if or .Params.tocBorder $.Site.Params.tocBorder }}with-border{{ end }}">
        <nav id="TableOfContents">
            <ul>
                <li>
                    <a href="#">目录</a>
                    <!-- Hugo's TOC will be injected here by script -->
                </li>
            </ul>
        </nav>
    </aside>
    {{ end }}
</div>

<script>
    // This script should be placed after the HTML content.
    const tocContainer = document.querySelector('.post-toc');
    if (tocContainer) {
        // Use a temporary div to render Hugo's TOC and extract its list
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = {{ .TableOfContents }};
        const hugoTocList = tempDiv.querySelector('ul');

        const customNavLi = tocContainer.querySelector('#TableOfContents > ul > li');

        if (hugoTocList && customNavLi) {
            // Append Hugo's generated list into our custom <li> element
            customNavLi.appendChild(hugoTocList);
        } else {
            // If no TOC was generated by Hugo, hide the entire sidebar.
            tocContainer.style.display = 'none';
        }
    }
</script>

{{ end }}